<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuickShop ‚Äî ArionsDesign</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#0f4af1;
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#6b7280;
  --radius:12px;
  --shadow:0 12px 30px rgba(15,23,42,0.06);
}
.dark{
  --bg:#0e0f11;
  --card:#1a1b1f;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --brand:#3b82f6;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:"Montserrat",system-ui;
  background:var(--bg);
  color:var(--text);
  line-height:1.5;
  overflow-x:hidden;
}
.container{width:94%;max-width:1100px;margin:auto}

/* TOPBAR */
.topbar{
  background:#071428;color:#fff;padding:9px 0;font-size:13px;
}
.topbar .row{
  display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;
}
.selectors select{
  background:transparent;border:1px solid rgba(255,255,255,0.2);
  color:#fff;padding:6px 8px;border-radius:8px;
}

/* HEADER */
header{
  background:var(--card);padding:14px 0;
  border-bottom:1px solid #e5e7eb;
  position:sticky;top:0;z-index:500;
}
.header-row{
  display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
}
.logo{font-size:22px;font-weight:700}
.logo span{color:var(--brand)}
.nav{display:flex;gap:18px;font-size:15px;}
.nav a{color:var(--text);text-decoration:none;}
.hamburger{display:none;background:none;border:0;font-size:26px;cursor:pointer;}

@media(max-width:860px){
  .nav{display:none}
  .hamburger{display:block}
}

/* THEME */
.theme-toggle{
  cursor:pointer;font-size:18px;padding:8px 10px;border-radius:8px;
  background:#f3f3f3;
}
.dark .theme-toggle{background:#333;color:#fff}

/* SEARCH */
.search{
  display:flex;gap:8px;flex:1;max-width:320px;
}
.search input{
  flex:1;padding:10px;border-radius:8px;
  border:1px solid #d7dce4;background:var(--card);color:var(--text);
}
.search button{
  padding:10px 14px;border-radius:8px;border:0;
  background:var(--brand);color:#fff;cursor:pointer;
}

/* SUGGESTIONS */
#suggestions{
  position:absolute;background:var(--card);width:90%;max-width:400px;
  margin-left:5%;margin-top:4px;box-shadow:var(--shadow);border-radius:10px;
  display:none;z-index:200;
}
#suggestions div{
  padding:10px;border-bottom:1px solid #eee;cursor:pointer;
}
#suggestions div:hover{background:#f3f7ff}

/* SIDE MENU */
.side-menu{
  position:fixed;top:0;left:-260px;width:260px;height:100%;
  background:var(--card);box-shadow:var(--shadow);
  padding:20px;transition:0.3s;z-index:600;
}
.side-menu.open{left:0}
.side-menu a{
  display:block;padding:12px 0;font-size:16px;color:var(--text);
  border-bottom:1px solid #eee;text-decoration:none;
}

/* Overlay */
.menu-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.4);
  z-index:550;display:none;
}
.menu-overlay.active{display:block}

/* HERO */
.hero-slider{margin:20px 0;border-radius:14px;overflow:hidden;}
.hero-slider img{width:100%;height:170px;object-fit:cover;}
@media(max-width:500px){.hero-slider img{height:130px}}

/* FILTERS */
.filters{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;}
.filters select{padding:8px;border-radius:8px;border:1px solid #ccc;}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(165px,1fr));
  gap:14px;margin-top:14px;
}
.card{
  background:var(--card);padding:12px;border-radius:12px;
  box-shadow:var(--shadow);display:flex;flex-direction:column;
}
.card img{
  width:100%;height:160px;object-fit:cover;border-radius:10px;
}
.title{font-weight:700;margin-top:8px;font-size:15px}
.category{color:var(--muted);font-size:13px}
.price{color:var(--brand);font-weight:800;margin-top:4px}
.actions{
  margin-top:auto;display:flex;gap:6px;flex-wrap:wrap;
}
.btn{
  flex:1;border-radius:8px;padding:10px;font-size:15px;
  border:1px solid #ddd;cursor:pointer;
}
.btn-primary{
  background:var(--brand);color:#fff;border:none;
}

/* CART FLOAT */
.cart-btn{
  position:fixed;bottom:20px;right:20px;background:var(--brand);color:white;
  padding:14px 18px;border-radius:50px;font-size:18px;
  display:flex;align-items:center;gap:6px;z-index:900;
  box-shadow:0 6px 12px rgba(0,0,0,0.2);
}
.cart-count{
  background:white;color:var(--brand);padding:2px 6px;border-radius:50%;font-weight:700;
}

/* FOOTER */
footer{padding:22px 0;text-align:center;color:var(--muted)}

@media(max-width:480px){
  .btn-primary{font-size:14px;padding:12px;}
  .btn{font-size:14px;padding:12px;}
}
</style>
</head>

<body>

<div id="menuOverlay" class="menu-overlay"></div>

<!-- TOPBAR -->
<div class="topbar">
  <div class="container row">
    <div class="selectors">
      <select id="langSelect"><option>EN</option><option>FR</option><option>AR</option></select>
      <select id="currencySelect"><option value="usd">USD $</option><option value="ghs">GHS ‚Çµ</option></select>
    </div>
    <div style="display:flex;gap:14px">
      <a href="auth.html" style="color:white">Login</a>
      <a href="admin.html" style="color:white">Admin</a>
    </div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="container header-row">
    <button class="hamburger" id="menuBtn">‚ò∞</button>
    <div class="logo"><span>Arions</span>Design</div>

    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="blog.html">Blog</a>
      <a href="contact.html">Contact</a>
      <a href="cart.html">Cart</a>
    </nav>

    <div class="theme-toggle" id="themeToggle">üåô</div>

    <div class="search">
      <input id="searchInput" placeholder="Search products...">
      <button id="searchBtn">üîç</button>
    </div>
  </div>
</header>

<div id="suggestions"></div>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
  <a href="index.html">Home</a>
  <a href="cart.html">My Cart</a>
  <a href="checkout.html">Checkout</a>
  <a href="orders.html">My Orders</a>
  <a href="auth.html">Login / Register</a>
  <a href="admin.html">Admin Panel</a>
  <a href="blog.html">Blog</a>
  <a href="contact.html">Contact</a>
</div>

<!-- HERO -->
<div class="container">
  <div class="hero-slider">
    <img src="https://i.imgur.com/Zq0eVTP.jpeg" alt="hero">
  </div>
</div>

<!-- FILTERS -->
<div class="container">
  <div class="filters">
    <select id="categoryFilter"><option value="all">All Categories</option></select>
    <select id="sortSelect">
      <option value="new">Newest</option>
      <option value="price_asc">Price ‚Üë</option>
      <option value="price_desc">Price ‚Üì</option>
    </select>
  </div>
</div>

<!-- PRODUCT GRID -->
<div class="container">
  <div id="grid" class="grid" aria-live="polite"></div>
</div>

<!-- CART FLOAT -->
<button class="cart-btn" onclick="location='cart.html'">
  üõí <span id="cartCount" class="cart-count">0</span>
</button>

<footer>
  ¬© <span id="year"></span> ArionsDesign ‚Äî All rights reserved
</footer>

<!-- SCRIPT -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://msavtmwvhyboplytisiz.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1zYXZ0bXd2aHlib3BseXRpc2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MjAxOTAsImV4cCI6MjA4MDE5NjE5MH0.PE_chxqgi335cTnnX4zaPCMTdIzM_LClnpWRRM_007E"
);

document.getElementById("year").textContent = new Date().getFullYear();

/* THEME */
const themeToggle=document.getElementById("themeToggle");
if(localStorage.theme==="dark"){
    document.body.classList.add("dark");
    themeToggle.textContent="‚òÄÔ∏è";
}
themeToggle.onclick=()=>{
 document.body.classList.toggle("dark");
 localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
 themeToggle.textContent=localStorage.theme==="dark"?"‚òÄÔ∏è":"üåô";
};

/* MENU */
const sideMenu=document.getElementById("sideMenu");
const menuBtn=document.getElementById("menuBtn");
const overlay=document.getElementById("menuOverlay");

menuBtn.onclick=()=>{sideMenu.classList.toggle("open");overlay.classList.toggle("active");}
overlay.onclick=()=>{sideMenu.classList.remove("open");overlay.classList.remove("active");}
sideMenu.querySelectorAll("a").forEach(a=>a.onclick=()=>{sideMenu.classList.remove("open");overlay.classList.remove("active");});

/* PRODUCTS */
const grid=document.getElementById("grid");
const currencySelect=document.getElementById("currencySelect");
const categoryFilter = document.getElementById("categoryFilter");
let allProducts=[];

function priceFormat(price){
 const currency=currencySelect.value;
 if(currency==="ghs") return "‚Çµ" + (price * 15).toFixed(2);
 return "$" + price.toFixed(2);
}

async function loadProducts(){
 grid.innerHTML = "<div style='grid-column:1/-1;text-align:center'>Loading...</div>";

 const {data, error} = await supabase
   .from("products")
   .select("*")
   .order("created_at",{ascending:false});

 if(error){
   grid.innerHTML = `<div style='grid-column:1/-1;text-align:center;color:#b91c1c'>Error loading products: ${error.message}</div>`;
   return;
 }

 allProducts = Array.isArray(data) ? data : [];
 populateCategoryFilter();
 renderProducts(allProducts);
}

function populateCategoryFilter(){
  const cats = Array.from(new Set(allProducts.map(p=>p.category || 'uncategorized')));
  categoryFilter.innerHTML = '<option value="all">All Categories</option>';
  cats.forEach(c=>{
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c.charAt(0).toUpperCase()+c.slice(1);
    categoryFilter.appendChild(opt);
  });
}

function renderProducts(list){
 grid.innerHTML = "";

 if(!list || list.length === 0){
   grid.innerHTML = `<div style='grid-column:1/-1;text-align:center' class="muted">No products found</div>`;
   return;
 }

 list.forEach(p=>{
   const url = (p.image_url && p.image_url.trim()) ? p.image_url : "https://via.placeholder.com/300?text=No+Image";
   const div = document.createElement("div");
   div.className = "card";
   // add data-id for delegation
   div.innerHTML = `
     <img src="${url}" alt="${escapeHtml(p.title || 'product')}" onerror="this.src='https://via.placeholder.com/300?text=No+Image'">
     <div class="title">${escapeHtml(p.title || 'Untitled')}</div>
     <div class="category">${escapeHtml(p.category || 'No category')}</div>
     <div class="price">${priceFormat(Number(p.price_usd || 0))}</div>
     <div class="actions">
       <button class="btn view-btn" data-id="${escapeAttr(p.id)}">View</button>
       <button class="btn-primary add-btn" data-id="${escapeAttr(p.id)}">Add to Cart</button>
     </div>
   `;
   grid.appendChild(div);
 });
}

/* safe helpers */
function escapeHtml(s){ return (''+s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function escapeAttr(s){ return (s===null||s===undefined) ? '' : String(s).replace(/"/g,'&quot;'); }

/* load */
loadProducts();

/* CART: robust implementation using delegation */
function getCart(){ return JSON.parse(localStorage.getItem("cart") || "[]"); }
function saveCart(c){ localStorage.setItem("cart", JSON.stringify(c)); updateCartCount(); }
function updateCartCount(){ document.getElementById("cartCount").textContent = getCart().length; }
updateCartCount();

async function addProductToCartById(id){
  // find product locally first (faster & less network)
  let product = allProducts.find(p => String(p.id) === String(id));
  if(!product){
    // fallback: fetch single product from supabase
    const { data, error } = await supabase.from('products').select('*').eq('id', id).single();
    if(error || !data) { alert('Product not found'); return; }
    product = data;
  }

  // normalize price
  const price = Number(product.price_usd ?? 0);

  const cart = getCart();
  cart.push({
    id: product.id,
    title: product.title || 'Untitled',
    price,
    image: product.image_url || ''
  });
  saveCart(cart);
  // small success UI
  const toast = document.createElement('div');
  toast.textContent = `"${product.title}" added to cart`;
  toast.style.position = 'fixed';
  toast.style.bottom = '90px';
  toast.style.right = '20px';
  toast.style.background = '#0f172a';
  toast.style.color = 'white';
  toast.style.padding = '10px 14px';
  toast.style.borderRadius = '8px';
  toast.style.zIndex = 1200;
  document.body.appendChild(toast);
  setTimeout(()=> toast.remove(), 1800);
}

/* Delegated click handler for add buttons & view buttons */
grid.addEventListener('click', (e) => {
  const addBtn = e.target.closest('.add-btn');
  if(addBtn){
    const id = addBtn.dataset.id;
    if(!id){ alert('Missing product id'); return; }
    addProductToCartById(id).catch(err=>{
      console.error(err);
      alert('Could not add to cart');
    });
    return;
  }
  const viewBtn = e.target.closest('.view-btn');
  if(viewBtn){
    const id = viewBtn.dataset.id;
    // navigate to product page (if you have product.html)
    location.href = `product.html?id=${encodeURIComponent(id)}`;
  }
});

/* SEARCH / SUGGESTIONS */
const sBox = document.getElementById("suggestions");
const input = document.getElementById("searchInput");
const searchBtn = document.getElementById("searchBtn");

input.addEventListener('input', ()=>{
  const q = input.value.trim().toLowerCase();
  if(!q){ sBox.style.display = 'none'; return; }
  const results = allProducts.filter(p => (p.title || '').toLowerCase().includes(q)).slice(0,8);
  sBox.innerHTML = results.map(r => `<div class="suggest-item" data-title="${escapeAttr(r.title)}">${escapeHtml(r.title)}</div>`).join('');
  sBox.style.display = results.length ? 'block' : 'none';
});

sBox.addEventListener('click', (e)=>{
  const item = e.target.closest('.suggest-item');
  if(!item) return;
  const text = item.dataset.title;
  input.value = text;
  sBox.style.display = 'none';
  // apply the search
  renderProducts(allProducts.filter(p => (p.title||'').toLowerCase().includes(text.toLowerCase())));
});

searchBtn.addEventListener('click', ()=>{
  const q = input.value.trim().toLowerCase();
  renderProducts(allProducts.filter(p => (p.title||'').toLowerCase().includes(q)));
  sBox.style.display = 'none';
});

/* close suggestions on outside click */
document.addEventListener('click', (e)=>{
  if(!e.target.closest('#searchInput') && !e.target.closest('#suggestions') && !e.target.closest('#searchBtn')){
    sBox.style.display = 'none';
  }
});

/* FILTERS */
document.getElementById("sortSelect").addEventListener('change', ()=>{
  let sorted = [...allProducts];
  const s = document.getElementById("sortSelect").value;
  if(s === "price_asc") sorted.sort((a,b)=> (a.price_usd||0) - (b.price_usd||0));
  if(s === "price_desc") sorted.sort((a,b)=> (b.price_usd||0) - (a.price_usd||0));
  renderProducts(sorted);
});

categoryFilter.addEventListener('change', ()=>{
  const cat = categoryFilter.value;
  const filtered = cat === 'all' ? allProducts : allProducts.filter(p => (p.category||'').toLowerCase() === cat.toLowerCase());
  renderProducts(filtered);
});

currencySelect.addEventListener('change', ()=> renderProducts(allProducts));

/* Utility: keep cart count in sync in case other pages change it */
window.addEventListener('storage', (e)=>{
  if(e.key === 'cart') updateCartCount();
});

</script>
</body>
</html>